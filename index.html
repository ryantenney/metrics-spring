<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>metrics-spring by ryantenney</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>metrics-spring</h1>
        <p>Spring integration for Yammer's Metrics library</p>
        <p class="view"><a href="https://github.com/ryantenney/metrics-spring">View the Project on GitHub <small>ryantenney/metrics-spring</small></a></p>
        <ul>
          <li><a href="https://github.com/ryantenney/metrics-spring/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ryantenney/metrics-spring/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ryantenney/metrics-spring">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Metrics for Spring <a href="http://travis-ci.org/ryantenney/metrics-spring"><img src="https://secure.travis-ci.org/ryantenney/metrics-spring.png" alt="Build Status"></a>
</h1>

<h1></h1>

<h2>About</h2>

<p>The <code>metrics-spring</code> module integrates <a href="http://metrics.codahale.com/">Yammer Metrics</a> with Spring AOP, complete with simple XML configuration.</p>

<p>This module does the following things:</p>

<ul>
<li>Proxies beans which contain methods annotated with <code>@Timed</code>, <code>@Metered</code>, and <code>@ExceptionMetered</code>
</li>
<li>Registers a <code>Gauge</code> for beans which have members annotated with <code>@Gauge</code>
</li>
<li>Registers with the <code>HealthCheckRegistry</code> any beans which extend the class <code>HealthCheck</code>
</li>
</ul><h3>Maven</h3>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.yammer.metrics&lt;/groupId&gt;
    &lt;artifactId&gt;metrics-spring&lt;/artifactId&gt;
    &lt;version&gt;2.1.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>This module was formerly contained in the <a href="https://github.com/codahale/metrics">Yammer Metrics repository</a>. Version 2.1.x will be the last version of this module available at these coordinates. This is the new official home of this project, and new coordinates will be available soon.</p>

<h3>Basic Usage</h3>

<p>Spring Context XML:</p>

<pre><code>&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:metrics="http://www.yammer.com/schema/metrics"
       xsi:schemaLocation="
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
            http://www.yammer.com/schema/metrics
            http://www.yammer.com/schema/metrics/metrics.xsd"&gt;

    &lt;metrics:annotation-driven /&gt;

    &lt;!-- beans --&gt;

&lt;/beans&gt;
</code></pre>

<p>Alternate, XML-less config:</p>

<pre><code>import org.springframework.context.annotation.Configuration;
import com.ryantenney.metrics.spring.config.annotation.EnableMetrics;

@Configuration
@EnableMetrics
public class SpringConfiguringClass {
    // ...
}
</code></pre>

<h3>XML Config</h3>

<p>The <code>&lt;metrics:annotation-driven /&gt;</code> element is required, and has 5 optional arguments:</p>

<ul>
<li>
<code>metrics-registry</code> - the id of the <code>MetricsRegsitry</code> bean with which the generated metrics should be registered. If omitted, this defaults to registry provided by <code>Metrics.defaultRegistry()</code>.</li>
<li>
<code>health-check-registry</code> - the id of the <code>HealthCheckRegsitry</code> bean with which to register any beans which extend the class <code>HealthCheck</code>. If omitted, this defaults to the registry provided by <code>HealthChecks.defaultRegistry()</code>.</li>
<li>
<code>scope</code> - sets the scope for each of the metrics.</li>
<li>
<code>proxy-target-class</code> - if set to true, always creates CGLIB proxies instead of defaulting to JDK proxies. This <em>may</em> be necessary if you use class-based autowiring.</li>
<li>
<code>expose-proxy</code> - if set to true, the target can access the proxy which wraps it by calling <code>AopContext.currentProxy()</code>.</li>
</ul><p>The elements <code>&lt;metrics:metrics-registry /&gt;</code> and <code>&lt;metrics:health-check-registry /&gt;</code> are present as a convenience for creating new registry beans.</p>

<p>The element <code>&lt;metrics:jmx-reporter /&gt;</code> creates a JMX Reporter for the specified metrics registry. A JMX Reporter is automatically created for the default metrics registry.</p>

<h3>A Note on the Limitations of Spring AOP</h3>

<p>Due to limitations of Spring AOP only public methods can be proxied, so <code>@Timed</code>, <code>@Metered</code>, and <code>@ExceptionMetered</code> have no effect on non-public methods. Additionally, calling an annotated method from within the same class will not go through the proxy.</p>

<pre><code>public class Foo {

    @Timed
    public void bar() { /* … */ }

    public void baz() {
        this.bar(); // doesn't pass through the proxy

        // fix: reengineer
        // workaround: enable `expose-proxy` and change to:
        ((Foo) AopContext.currentProxy()).bar(); // hideous, but it works
    }
}
</code></pre>

<p>As <code>@Gauge</code> doesn’t involve a proxy, it is possible to use this annotation on private fields and methods.</p>

<h2>License</h2>

<h1></h1>

<p>Copyright (c) 2012 Ryan Tenney, Martello Technologies</p>

<p>Published under Apache Software License 2.0, see LICENSE</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/ryantenney">ryantenney</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>